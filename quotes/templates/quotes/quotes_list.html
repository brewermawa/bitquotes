{% extends "base.html" %}

{% block title %} - Cotizaciones{% endblock %}
{% block nav_active_cotizaciones %}active{% endblock %}

{% block content_header %}
  <div class="d-flex align-items-end justify-content-between mt-3 mb-2">
    <div>
      <h1 class="h4 mb-2 d-flex align-items-center gap-2">
        <i class="bi bi-file-earmark-text"></i> Cotizaciones
      </h1>
      <small class="text-muted">Listado general de cotizaciones</small>
    </div>
    <div>
      <a href="{% url 'quotes:quote_create' %}" class="btn btn-primary d-flex align-items-center gap-2">
        <i class="bi bi-plus-circle"></i> <span>Nueva cotización</span>
      </a>
    </div>
  </div>
  <hr class="mt-2 mb-3">
{% endblock content_header %}

{% block content %}
  {% if quotes %}
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th style="min-width:160px;">Cotización</th>
            <th style="min-width:260px;">Cliente</th>
            <th style="min-width:220px;">Contacto</th>
            <th style="min-width:140px;">Estatus</th>
            <th class="text-end" style="min-width:120px;">Total</th>
            <th style="min-width:170px;">Creada</th>
            <th class="text-end" style="min-width:160px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for q in quotes %}
            <tr>
              <td class="fw-semibold">
                <a class="text-decoration-none" href="{% url 'quotes:quote_detail' q.id %}">
                  {{ q.quote_id|default:q.id }}
                </a>
              </td>
              <td>{{ q.customer.name }}</td>
              <td>
                {% if q.contact %}
                  {{ q.contact.first_name }} {{ q.contact.last_name }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>
                {# badge simple por ahora #}
                <span class="badge text-bg-secondary">{{ q.get_status_display }}</span>
              </td>
              <td class="text-end">
                ${{ q.total|floatformat:2 }}
              </td>
              <td>
                {{ q.created|date:"Y-m-d H:i" }}
              </td>
              <td class="text-end">
                <div class="btn-group" role="group">
                  <a href="{% url 'quotes:quote_detail' q.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i> Ver
                  </a>
                  <a href="{% url 'quotes:quote_edit' q.id %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-pencil"></i> Editar
                  </a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <nav class="mt-3" aria-label="Paginación de cotizaciones">
        <ul class="pagination justify-content-end">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Anterior</span></li>
          {% endif %}

          {% for i in paginator.page_range %}
            {% if page_obj.number == i %}
              <li class="page-item active"><span class="page-link">{{ i }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="card border-0 text-center py-5 my-4">
      <div class="card-body">
        <div class="display-6 mb-2"><i class="bi bi-file-earmark-text"></i></div>
        <h5 class="card-title mb-2">No hay cotizaciones</h5>
        <p class="text-muted mb-3">Crea tu primera cotización para verla aquí.</p>
        <a href="{% url 'quotes:quote_create' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i> Nueva cotización
        </a>
      </div>
    </div>
  {% endif %}
{% endblock content %}
