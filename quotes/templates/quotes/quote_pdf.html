{% load static humanize %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cotización {{ quote.number }}</title>
    <link rel="stylesheet" href="{% static 'css/quote_pdf.css' %}">
</head>
<body>

    <!-- ENCABEZADO EMPRESA -->
    <div class="header">
        <table class="header-table header-table-v2">
            <tr>
                <!-- Texto a la izquierda -->
                <td class="header-left">
                    <div class="company-name">
                        Big Impression Tecnología, SA de CV
                    </div>
                    <div class="company-info">
                        Vasconcelos 101 Local 1<br>
                        Bosques del Valle, San Pedro GG C.P. 66250<br>
                        <span class="company-web">http://www.bi-tecnologia.com</span><br>
                        <span class="company-distributor">DISTRIBUIDOR AUTORIZADO HP DESIGNJET</span>
                    </div>
                </td>

                <!-- Logo BI a la derecha -->
                <td class="header-right">
                    <img src="{% static 'images/logo-bit.png' %}" class="logo-bi">
                </td>
            </tr>

            <tr>
                <td colspan="2" class="header-tagline">
                    Contamos con toda la línea de cartuchos HP originales, cabezales, papeles para impresión,
                    servicio de mantenimiento preventivo y correctivo, servicio de impresión.
                </td>
            </tr>
        </table>
    </div>

    <!-- BLOQUE CLIENTE Y FECHA -->
    <div class="client-date-row">
        <div class="client-block">
            <div class="client-name">
                {{ quote.customer.name }}
            </div>
            <div class="client-contact">
                Attn: {{ quote.contact.full_name }}<br>
                {% if quote.contact.phone %}
                    Tel. {{ quote.contact.formatted_phone }}    
                {% endif %}

                {% if quote.contact.phone and quote.contact.cel_phone %}
                    <br>
                {% endif %}

                {% if quote.contact.cel_phone %}
                    Cel. {{ quote.contact.formatted_cel_phone }}    
                {% endif %}
            </div>
        </div>
        <div class="right-date">
            Monterrey, N.L. a {{ quote.created|date:"j \\d\\e F \\d\\e Y" }}
        </div>
    </div>

    <!-- SALUDO / INTRO -->
    <p class="greeting">
        Estimado {{ quote.contact.first_name }}:
        <br><br>
        Agradeciendo su preferencia por los productos y servicios que ofrecemos en BI Tecnología,
        a continuación le presento la cotización de los productos solicitados para su consideración:
    </p>

    {% for section in quote.quote_sections.all %}
    {% cycle 'qs-blue' 'qs-peach' as section_theme silent %}

    <div class="quote-section {{ section_theme }}">
        <table class="qs-table">
        <thead>
            <tr class="qs-head-row">
            <th class="qs-title" colspan="2">{{ section.name }}</th>
            <th class="qs-col-qty">Cantidad</th>
            <th class="qs-col-unit">Precio<br>unitario</th>
            <th class="qs-col-sub">Subtotal</th>
            </tr>
        </thead>

        <tbody>
            {% for line in section.lines.all %}
            <tr class="qs-item-row">
                <td class="qs-sku">
                {% if line.product.sku %}{{ line.product.sku }}{% else %}-{% endif %}
                </td>

                <td class="qs-desc">
                <div class="qs-item-name">{{ line.product.name }}</div>

                {% if line.description %}
                    <div class="qs-item-detail">{{ line.description }}</div>
                {% elif line.product.short_description %}
                    <div class="qs-item-detail">{{ line.product.short_description }}</div>
                {% endif %}
                </td>

                <td class="qs-qty">
                {{ line.quantity|floatformat:0 }}
                </td>

                <td class="qs-unit">
                {% if line.unit_price and line.unit_price > 0 %}
                    ${{ line.unit_price|floatformat:2|intcomma }}
                {% else %}
                    Sin costo
                {% endif %}
                </td>

                <td class="qs-subtotal">
                {% if line.line_total and line.line_total > 0 %}
                    ${{ line.line_total|floatformat:2|intcomma }}
                {% else %}
                    <!-- en tu ejemplo, “Sin costo” no muestra subtotal -->
                    &nbsp;
                {% endif %}
                </td>
            </tr>
            {% endfor %}

            <!-- Totales por sección (derecha, abajo) -->
            <tr class="qs-totals-row">
            <td colspan="5">
                <div class="qs-totals">
                <div class="qs-tot-line">
                    <span class="qs-tot-label">Subtotal</span>
                    <span class="qs-tot-val">${{ section.subtotal|floatformat:2|intcomma }}</span>
                </div>
                <div class="qs-tot-line">
                    <span class="qs-tot-label">IVA</span>
                    <span class="qs-tot-val">${{ section.tax_total|floatformat:2|intcomma }}</span>
                </div>
                <div class="qs-tot-line qs-tot-strong">
                    <span class="qs-tot-label">Total</span>
                    <span class="qs-tot-val">${{ section.total|floatformat:2|intcomma }}</span>
                </div>
                </div>
            </td>
            </tr>

        </tbody>
        </table>
    </div>
    {% endfor %}

</body>
</html>
